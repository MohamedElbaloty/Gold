<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <script>
      (function(){ var t=localStorage.getItem('ui.theme'); var l=localStorage.getItem('ui.lang'); if(!t) document.documentElement.classList.add('dark'); if(!l) { document.documentElement.lang='ar'; document.documentElement.setAttribute('dir','rtl'); } else if(l==='ar') { document.documentElement.lang='ar'; document.documentElement.setAttribute('dir','rtl'); } else { document.documentElement.lang='en'; document.documentElement.setAttribute('dir','ltr'); } })();
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Gold Bullion Trading Platform - Saudi Arabia" />
    <!-- Allow Google Fonts (Inter, etc.) so CSP does not block stylesheets -->
    <meta http-equiv="Content-Security-Policy" content="style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; style-src-elem 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com data:;">
    <title>Gold Trading Platform</title>
    <script>
      (function () {
        // 1) Intercept fetch/XHR for support-portal (TradingView widget 403 â€” avoid request and noise)
        function isTvSupportUrl(url) {
          if (typeof url !== 'string') return false;
          return url.indexOf('tradingview-widget') !== -1 && (url.indexOf('support') !== -1 || url.indexOf('problems') !== -1) ||
            url.indexOf('support-portal-problems') !== -1;
        }
        var emptyJson = function () { return Promise.resolve({}); };
        var fakeRes = { ok: true, status: 200, json: emptyJson, text: function () { return Promise.resolve('{}'); } };
        var origFetch = window.fetch;
        if (origFetch) {
          window.fetch = function (input, init) {
            var url = typeof input === 'string' ? input : (input && input.url) || '';
            if (isTvSupportUrl(url)) return Promise.resolve(fakeRes);
            return origFetch.apply(this, arguments);
          };
        }
        var origOpen = XMLHttpRequest.prototype.open;
        XMLHttpRequest.prototype.open = function (method, url) {
          if (isTvSupportUrl(url)) this._skipTvSupport = true;
          return origOpen.apply(this, arguments);
        };
        var origSend = XMLHttpRequest.prototype.send;
        XMLHttpRequest.prototype.send = function () {
          if (this._skipTvSupport) {
            try {
              this.readyState = 4;
              this.status = 200;
              this.responseText = '{}';
              if (this.onreadystatechange) this.onreadystatechange();
              if (this.onload) this.onload({ target: this });
            } catch (e) {}
            return;
          }
          return origSend.apply(this, arguments);
        };

        // 2) Hide TradingView / snowplow / lockdown noise in console (log, warn, error)
        function shouldSuppressConsole() {
          var s = '';
          for (var i = 0; i < arguments.length; i++) s += (arguments[i] != null ? arguments[i].toString() : '') + ' ';
          if (/support-portal-problems|support-portal-problems\?/.test(s)) return true;
          if (/Couldn't load support portal|DataProblemModel|Chart\.DataProblemModel/.test(s)) return true;
          if (/tradingview-widget|Fetch:.*support|Status 403|support.*403|:\/support\//.test(s)) return true;
          if (/Invalid environment undefined/.test(s) && /snowplow|embed-widget/.test(s)) return true;
          if (/SES Removing unpermitted intrinsics|lockdown-install|unpermitted intrinsics|lockdown\.js/.test(s)) return true;
          return false;
        }
        var origLog = console.log, origWarn = console.warn, origError = console.error;
        function applyConsolePatch() {
          console.log = function () { if (shouldSuppressConsole.apply(null, arguments)) return; return origLog.apply(console, arguments); };
          console.warn = function () { if (shouldSuppressConsole.apply(null, arguments)) return; return origWarn.apply(console, arguments); };
          console.error = function () { if (shouldSuppressConsole.apply(null, arguments)) return; return origError.apply(console, arguments); };
        }
        applyConsolePatch();
        if (window.addEventListener) {
          window.addEventListener('load', applyConsolePatch);
          var reapply = 0;
          var tid = setInterval(function () { reapply++; applyConsolePatch(); if (reapply >= 5) clearInterval(tid); }, 2000);
        }

        function isThirdPartyScriptError(message, source) {
          var msg = (message || '').toString().trim();
          var isScriptError = msg === 'Script error.' || msg === 'Script error' || msg === '';
          var isTradingView =
            source &&
            (source.indexOf('tradingview.com') !== -1 ||
              source.indexOf('s3.tradingview.com') !== -1);
          var isTvOrLockdownMsg = /SES Removing unpermitted|DataProblemModel|support portal problems|lockdown-install/.test(msg);
          var isLockdownSource = source && (source.indexOf('lockdown') !== -1 || source.indexOf('tradingview') !== -1);
          return isScriptError || isTradingView || isTvOrLockdownMsg || isLockdownSource;
        }

        // Suppress third-party script errors before React/dev-overlay attaches
        window.addEventListener(
          'error',
          function (event) {
            if (isThirdPartyScriptError(event.message, event.filename)) {
              event.preventDefault();
              event.stopPropagation();
              event.stopImmediatePropagation();
              // Optional debug log in dev-like environments where process may exist
              if (
                typeof process !== 'undefined' &&
                process.env &&
                process.env.NODE_ENV !== 'production'
              ) {
                console.warn('Suppressed third-party script error:', event.message);
              }
              return true;
            }
          },
          true
        );

        // Best-effort: neutralize React dev overlay global handler if it gets set later
        Object.defineProperty(window, '__REACT_ERROR_OVERLAY_GLOBAL_HANDLER__', {
          configurable: true,
          set: function () {
            // ignore assignments to keep overlay from handling errors
          },
        });
      })();
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <script>
      // Intercept TradingView support-portal request (403) via Service Worker when possible
      if ('serviceWorker' in navigator && location.protocol !== 'file:') {
        window.addEventListener('load', function () {
          navigator.serviceWorker.register('/sw-tv-intercept.js', { scope: '/' })
            .then(function () {})
            .catch(function () {});
        });
      }
    </script>
  </body>
</html>
